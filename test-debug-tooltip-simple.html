<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Tooltip Extraction Test</title>
    <style>
        .editor-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .test-controls {
            margin: 20px 0;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .test-controls button {
            margin: 5px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-controls button:hover {
            background: #0056b3;
        }
        .status {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.enabled {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.disabled {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>

<div class="editor-container">
    <h1>Debug Tooltip Extraction Test</h1>
    <p>This test verifies that the debug tooltip functionality has been successfully extracted to its own class.</p>
    
    <div class="test-controls">
        <h3>Test Controls:</h3>
        <button onclick="toggleDebug()">Toggle Debug Mode</button>
        <div id="debug-status" class="status">Debug Mode: LOADING...</div>
    </div>

    <div id="editor" class="editor"></div>
    
    <div class="test-results">
        <h3>Test Results:</h3>
        <div id="test-output"></div>
    </div>
</div>

<script type="module">
    import './src/css/editor.css';
    import './src/css/prism-theme.css';
    import '@fortawesome/fontawesome-free/css/all.min.css';
    import { Editor } from './src/Editor.js';
    import { EVENTS } from './src/utils/eventEmitter.js';

    let editor;
    const statusDiv = document.getElementById('debug-status');
    const outputDiv = document.getElementById('test-output');

    function addTestResult(message, isPass) {
        const div = document.createElement('div');
        div.style.margin = '5px 0';
        div.style.padding = '5px';
        div.style.borderRadius = '3px';
        div.style.background = isPass ? '#d4edda' : '#f8d7da';
        div.style.color = isPass ? '#155724' : '#721c24';
        div.innerHTML = `${isPass ? '✅' : '❌'} ${message}`;
        outputDiv.appendChild(div);
    }

    // Initialize editor with debug mode enabled
    try {
        editor = new Editor({
            id: 'editor',
            container: document.querySelector('.editor-container'),
            debug: true, // Start with debug mode enabled
            text: `# Debug Tooltip Test

## Sample Content

This is a paragraph block with some sample content for testing debug tooltips.

### Lists

- Item 1
- Item 2
- Item 3

\`\`\`javascript
// Code block
console.log('Hello, Debug!');
\`\`\`

> Quote block for testing`
        });

        console.log('Editor initialized successfully');
        
        // Update status
        updateDebugStatus(editor.debugMode);
        
        // Listen for debug mode changes
        editor.on(EVENTS.DEBUG_MODE_CHANGED, (data) => {
            updateDebugStatus(data.debugMode);
            console.log('Debug mode changed:', data.debugMode);
        });

        // Run tests
        runTests();

    } catch (error) {
        console.error('Failed to initialize editor:', error);
        statusDiv.textContent = 'INITIALIZATION FAILED';
        statusDiv.className = 'status disabled';
        addTestResult('Editor initialization failed: ' + error.message, false);
    }

    // Global function for test control
    window.toggleDebug = function() {
        if (editor) {
            editor.toggleDebugMode();
        }
    };

    function updateDebugStatus(isEnabled) {
        if (isEnabled) {
            statusDiv.textContent = 'Debug Mode: ENABLED';
            statusDiv.className = 'status enabled';
        } else {
            statusDiv.textContent = 'Debug Mode: DISABLED';
            statusDiv.className = 'status disabled';
        }
    }

    function runTests() {
        console.log('Running debug tooltip extraction tests...');
        
        // Test 1: Verify DebugTooltip instance exists
        const hasDebugTooltip = editor && editor.debugTooltip;
        addTestResult('DebugTooltip instance exists on Editor', hasDebugTooltip);
        
        // Test 2: Verify DebugTooltip has required methods
        if (hasDebugTooltip) {
            const requiredMethods = ['enable', 'disable', 'toggle', 'isEnabled'];
            const methodsExist = requiredMethods.every(method => 
                typeof editor.debugTooltip[method] === 'function'
            );
            addTestResult('DebugTooltip has required methods', methodsExist);
        }
        
        // Test 3: Verify debug methods were removed from Editor
        const debugMethodsToRemove = [
            'createDebugTooltips',
            'createDebugTooltip', 
            'positionDebugTooltip',
            'updateDebugTooltipContent',
            'removeDebugTooltips',
            'startDebugUpdateLoop',
            'stopDebugUpdateLoop',
            'updateActiveBlockTooltip'
        ];
        
        const methodsRemoved = debugMethodsToRemove.every(method => 
            typeof editor[method] !== 'function'
        );
        addTestResult('Debug methods removed from Editor class', methodsRemoved);
        
        // Test 4: Verify debug mode functionality
        const debugModeWorks = typeof editor.toggleDebugMode === 'function';
        addTestResult('Debug mode toggle functionality exists', debugModeWorks);
        
        // Test 5: Verify CSS classes
        const hasDebugModeClass = editor.debugMode && editor.instance.classList.contains('debug-mode');
        addTestResult('Debug mode CSS class applied correctly', hasDebugModeClass);
        
        // Test 6: Check for tooltip elements in DOM
        setTimeout(() => {
            const tooltips = document.querySelectorAll('.debug-tooltip');
            const hasTooltips = tooltips.length > 0;
            addTestResult(`Debug tooltips present in DOM (${tooltips.length} found)`, hasTooltips);
            
            if (hasTooltips) {
                addTestResult('Debug tooltip content appears valid', 
                    tooltips[0].textContent.includes('Block'));
            }
        }, 100);
        
        console.log('Tests completed!');
    }
</script>

</body>
</html>
